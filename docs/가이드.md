# ğŸš€ Java í™˜ê²½ì •ë³´ ì„œë¹„ìŠ¤ ì´ˆê°„ë‹¨ êµ¬ì¶• ê°€ì´ë“œ

## ğŸ“‹ ê¸°ì¡´ PHP êµ¬ì¡° ë¶„ì„ â†’ Java ë³€í™˜

### ğŸ¯ í•µì‹¬ êµ¬ì¡° ë§¤í•‘
```
PHP êµ¬ì¡°                     â†’  Java Spring Boot êµ¬ì¡°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/core/engine/                â†’  @Configuration, @Service
/mediaplay/{code}/           â†’  /player/{code}/
/modules/controller/api/     â†’  @RestController 
var/var.*.php                â†’  application.yml
/data/data.*.php             â†’  @Scheduled ë©”ì„œë“œ
í…Œë§ˆ auto.php                â†’  Thymeleaf í…œí”Œë¦¿
```

## âš¡ 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ê¸°ë³¸ êµ¬ì¡° (5ë¶„)

### ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
src/main/java/com/ledcloud/
â”œâ”€â”€ LedcloudApplication.java
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ PlayerConfig.java          # í”Œë ˆì´ì–´ ì„¤ì •
â”‚   â””â”€â”€ SchedulerConfig.java       # API í˜¸ì¶œ ìŠ¤ì¼€ì¤„ëŸ¬
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ PlayerController.java      # í”Œë ˆì´ì–´ í˜ì´ì§€
â”‚   â””â”€â”€ ApiController.java         # ë°ì´í„° API
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ WeatherService.java        # ê¸°ìƒì²­ API
â”‚   â”œâ”€â”€ AirService.java           # ëŒ€ê¸°ì§ˆ API
â”‚   â””â”€â”€ DataCollectorService.java  # ë°ì´í„° ìˆ˜ì§‘
â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ Player.java               # í”Œë ˆì´ì–´ ì •ë³´
â”‚   â”œâ”€â”€ WeatherData.java          # ë‚ ì”¨ ë°ì´í„°
â”‚   â””â”€â”€ AirData.java              # ëŒ€ê¸°ì§ˆ ë°ì´í„°
â””â”€â”€ repository/
    â”œâ”€â”€ PlayerRepository.java
    â”œâ”€â”€ WeatherRepository.java
    â””â”€â”€ AirRepository.java

src/main/resources/
â”œâ”€â”€ application.yml               # DB, API ì„¤ì •
â”œâ”€â”€ player-config.json           # í”Œë ˆì´ì–´ë³„ ì„¤ì •
â””â”€â”€ static/player/{code}/        # ì •ì  ë¦¬ì†ŒìŠ¤
    â”œâ”€â”€ css/
    â”œâ”€â”€ js/
    â”œâ”€â”€ images/
    â””â”€â”€ themes/
```

## âš¡ 2ë‹¨ê³„: í•µì‹¬ ì„¤ì • íŒŒì¼ (5ë¶„)

### application.yml
```yaml
spring:
  datasource:
    url: jdbc:h2:mem:ledcloud;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
  h2:
    console:
      enabled: true

# ê³µê³µ API ì„¤ì •
api:
  weather:
    service-key: "ë‹¹ì‹ ì˜_ê¸°ìƒì²­_API_í‚¤"
    base-url: "http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0"
  air:
    service-key: "ë‹¹ì‹ ì˜_ëŒ€ê¸°ì§ˆ_API_í‚¤" 
    base-url: "http://apis.data.go.kr/B552584/ArpltnInforInqireSvc"

# ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •
scheduler:
  weather:
    cron: "0 */10 * * * *"  # 10ë¶„ë§ˆë‹¤
  air:
    cron: "0 */30 * * * *"  # 30ë¶„ë§ˆë‹¤
```

### player-config.json (ìˆ˜ë™ ì„¤ì •)
```json
{
  "240025": {
    "name": "ì„œìš¸ì‹œì²­",
    "location": {
      "nx": 60,
      "ny": 127,
      "region": "ì„œìš¸",
      "stationName": "ì¤‘êµ¬"
    },
    "api": ["weather", "air"],
    "theme": "default",
    "service": {
      "start": "2024-01-01",
      "end": "2025-12-31",
      "state": 0
    }
  }
}
```

## âš¡ 3ë‹¨ê³„: í•µì‹¬ Entity (5ë¶„)

### WeatherData.java
```java
@Entity
@Table(name = "weather_data")
public class WeatherData {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private String playerCode;  // ì¤‘ë³µ ë°©ì§€
    
    private String region;
    private Double temperature;
    private String weather;
    private String skyState;
    private Integer humidity;
    private String windDirection;
    private Double windSpeed;
    private Integer rainProbability;
    
    @Column(name = "update_time")
    private LocalDateTime updateTime;
    
    // ìƒì„±ì, getter, setter ìƒëµ
}
```

### AirData.java
```java
@Entity
@Table(name = "air_data")
public class AirData {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private String playerCode;  // ì¤‘ë³µ ë°©ì§€
    
    private String stationName;
    private Integer pm10Value;
    private String pm10Grade;
    private Integer pm25Value; 
    private String pm25Grade;
    private Integer caiValue;
    private String caiGrade;
    private Double o3Value;
    private String o3Grade;
    
    @Column(name = "update_time")
    private LocalDateTime updateTime;
    
    // ìƒì„±ì, getter, setter ìƒëµ
}
```

## âš¡ 4ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘ ì„œë¹„ìŠ¤ (10ë¶„)

### WeatherService.java
```java
@Service
@Slf4j
public class WeatherService {
    
    @Value("${api.weather.service-key}")
    private String serviceKey;
    
    @Value("${api.weather.base-url}")
    private String baseUrl;
    
    @Autowired
    private WeatherRepository weatherRepository;
    
    @Autowired
    private RestTemplate restTemplate;
    
    public WeatherData getWeatherData(String playerCode, int nx, int ny) {
        try {
            String url = buildWeatherUrl(nx, ny);
            String response = restTemplate.getForObject(url, String.class);
            
            // XML íŒŒì‹± í›„ WeatherData ê°ì²´ ìƒì„±
            WeatherData weatherData = parseWeatherXml(response, playerCode);
            
            return weatherData;
            
        } catch (Exception e) {
            log.error("ë‚ ì”¨ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: {}", e.getMessage());
            return null;
        }
    }
    
    private String buildWeatherUrl(int nx, int ny) {
        LocalDateTime now = LocalDateTime.now();
        String baseDate = now.format(DateTimeFormatter.ofPattern("yyyyMMdd"));
        String baseTime = getBaseTime(now.getHour());
        
        return UriComponentsBuilder.fromHttpUrl(baseUrl + "/getVilageFcst")
                .queryParam("serviceKey", serviceKey)
                .queryParam("pageNo", "1")
                .queryParam("numOfRows", "1000")
                .queryParam("dataType", "XML")
                .queryParam("base_date", baseDate)
                .queryParam("base_time", baseTime)
                .queryParam("nx", nx)
                .queryParam("ny", ny)
                .toUriString();
    }
    
    private String getBaseTime(int hour) {
        // ê¸°ìƒì²­ API ë°œí‘œ ì‹œê°„ì— ë§ì¶° ì¡°ì •
        if (hour < 2) return "2300";
        else if (hour < 5) return "0200"; 
        else if (hour < 8) return "0500";
        else if (hour < 11) return "0800";
        else if (hour < 14) return "1100";
        else if (hour < 17) return "1400";
        else if (hour < 20) return "1700";
        else if (hour < 23) return "2000";
        else return "2300";
    }
}
```

### DataCollectorService.java (ìŠ¤ì¼€ì¤„ëŸ¬)
```java
@Service
@Slf4j
public class DataCollectorService {
    
    @Autowired
    private WeatherService weatherService;
    
    @Autowired
    private AirService airService;
    
    @Autowired
    private WeatherRepository weatherRepository;
    
    @Autowired
    private AirRepository airRepository;
    
    @Value("${player.config.file:classpath:player-config.json}")
    private Resource configFile;
    
    @Scheduled(cron = "${scheduler.weather.cron}")
    public void collectWeatherData() {
        try {
            Map<String, Object> playerConfigs = loadPlayerConfigs();
            
            for (Map.Entry<String, Object> entry : playerConfigs.entrySet()) {
                String playerCode = entry.getKey();
                Map<String, Object> config = (Map<String, Object>) entry.getValue();
                Map<String, Object> location = (Map<String, Object>) config.get("location");
                
                int nx = (Integer) location.get("nx");
                int ny = (Integer) location.get("ny");
                
                // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ (ì¤‘ë³µ ë°©ì§€)
                weatherRepository.deleteByPlayerCode(playerCode);
                
                // ìƒˆ ë°ì´í„° ìˆ˜ì§‘
                WeatherData weatherData = weatherService.getWeatherData(playerCode, nx, ny);
                if (weatherData != null) {
                    weatherRepository.save(weatherData);
                    log.info("ë‚ ì”¨ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ: {}", playerCode);
                }
            }
        } catch (Exception e) {
            log.error("ë‚ ì”¨ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨: {}", e.getMessage());
        }
    }
    
    @Scheduled(cron = "${scheduler.air.cron}")
    public void collectAirData() {
        // ëŒ€ê¸°ì§ˆ ë°ì´í„° ìˆ˜ì§‘ (ìœ„ì™€ ë™ì¼í•œ íŒ¨í„´)
    }
}
```

## âš¡ 5ë‹¨ê³„: ì»¨íŠ¸ë¡¤ëŸ¬ (10ë¶„)

### PlayerController.java
```java
@Controller
@RequestMapping("/player")
public class PlayerController {
    
    @Autowired
    private WeatherRepository weatherRepository;
    
    @Autowired
    private AirRepository airRepository;
    
    @GetMapping("/{playerCode}")
    public String showPlayer(@PathVariable String playerCode, Model model) {
        
        // ë°ì´í„° ì¡°íšŒ
        WeatherData weather = weatherRepository.findByPlayerCode(playerCode);
        AirData air = airRepository.findByPlayerCode(playerCode);
        
        model.addAttribute("weather", weather);
        model.addAttribute("air", air);
        model.addAttribute("playerCode", playerCode);
        
        return "player/main";  // templates/player/main.html
    }
}

@RestController
@RequestMapping("/api")
public class ApiController {
    
    @Autowired
    private WeatherRepository weatherRepository;
    
    @Autowired 
    private AirRepository airRepository;
    
    @GetMapping("/weather/{playerCode}")
    public ResponseEntity<WeatherData> getWeatherData(@PathVariable String playerCode) {
        WeatherData weather = weatherRepository.findByPlayerCode(playerCode);
        return ResponseEntity.ok(weather);
    }
    
    @GetMapping("/air/{playerCode}")
    public ResponseEntity<AirData> getAirData(@PathVariable String playerCode) {
        AirData air = airRepository.findByPlayerCode(playerCode);
        return ResponseEntity.ok(air);
    }
}
```

## âš¡ 6ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ (15ë¶„)

### templates/player/main.html
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í™˜ê²½ì •ë³´ ë””ìŠ¤í”Œë ˆì´</title>
    <link rel="stylesheet" th:href="@{'/player/' + ${playerCode} + '/css/style.css'}">
</head>
<body>
    <div class="container">
        <div class="weather-section">
            <h2>ë‚ ì”¨ì •ë³´</h2>
            <div class="weather-info">
                <span class="temperature" th:text="${weather.temperature} + 'Â°C'">-</span>
                <span class="weather-state" th:text="${weather.weather}">-</span>
                <span class="humidity" th:text="'ìŠµë„: ' + ${weather.humidity} + '%'">-</span>
            </div>
        </div>
        
        <div class="air-section">
            <h2>ëŒ€ê¸°ì§ˆì •ë³´</h2>
            <div class="air-info">
                <div class="pm-info">
                    <span>ë¯¸ì„¸ë¨¼ì§€(PM10): </span>
                    <span th:text="${air.pm10Value}" th:class="'pm-' + ${air.pm10Grade}">-</span>
                </div>
                <div class="pm-info">
                    <span>ì´ˆë¯¸ì„¸ë¨¼ì§€(PM2.5): </span>
                    <span th:text="${air.pm25Value}" th:class="'pm-' + ${air.pm25Grade}">-</span>
                </div>
            </div>
        </div>
    </div>
    
    <script th:src="@{'/player/' + ${playerCode} + '/js/main.js'}"></script>
</body>
</html>
```

### static/player/240025/css/style.css
```css
.container {
    display: flex;
    flex-direction: column;
    padding: 20px;
    font-family: Arial, sans-serif;
}

.weather-section, .air-section {
    margin-bottom: 30px;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.weather-section {
    background: linear-gradient(135deg, #74b9ff, #0984e3);
    color: white;
}

.air-section {
    background: linear-gradient(135deg, #fd79a8, #e84393);
    color: white;
}

.temperature {
    font-size: 3em;
    font-weight: bold;
}

.pm-good { color: #00b894; }
.pm-normal { color: #fdcb6e; }
.pm-bad { color: #e17055; }
.pm-very-bad { color: #d63031; }
```

### static/player/240025/js/main.js
```javascript
// 5ë¶„ë§ˆë‹¤ ë°ì´í„° ìë™ ê°±ì‹ 
setInterval(function() {
    fetch(`/api/weather/${playerCode}`)
        .then(response => response.json())
        .then(data => {
            document.querySelector('.temperature').textContent = data.temperature + 'Â°C';
            document.querySelector('.weather-state').textContent = data.weather;
            document.querySelector('.humidity').textContent = 'ìŠµë„: ' + data.humidity + '%';
        });
        
    fetch(`/api/air/${playerCode}`)
        .then(response => response.json())
        .then(data => {
            // ëŒ€ê¸°ì§ˆ ì •ë³´ ì—…ë°ì´íŠ¸
        });
}, 300000); // 5ë¶„
```

## âš¡ 7ë‹¨ê³„: ë¹Œë“œ ë° ì‹¤í–‰ (5ë¶„)

### pom.xml ì˜ì¡´ì„± ì¶”ê°€
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-thymeleaf</artifactId>
    </dependency>
    <dependency>
        <groupId>com.h2database</groupId>
        <artifactId>h2</artifactId>
        <scope>runtime</scope>
    </dependency>
</dependencies>
```

## ğŸš€ ì¦‰ì‹œ ì‹¤í–‰ ë°©ë²•

```bash
# 1. í”„ë¡œì íŠ¸ ìƒì„±
mvn spring-boot:run

# 2. ì ‘ì† í™•ì¸
http://localhost:8080/player/240025

# 3. API í…ŒìŠ¤íŠ¸  
http://localhost:8080/api/weather/240025
http://localhost:8080/api/air/240025

# 4. H2 ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
http://localhost:8080/h2-console
```

## ğŸ“ ì„¤ì • ë³€ê²½ ë°©ë²•

1. **ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€**: `player-config.json`ì— ìƒˆ ì½”ë“œ ì¶”ê°€
2. **API í‚¤ ì„¤ì •**: `application.yml`ì˜ `service-key` ê°’ ë³€ê²½
3. **ìˆ˜ì§‘ ì£¼ê¸° ë³€ê²½**: `application.yml`ì˜ `cron` ì„¤ì • ë³€ê²½
4. **í…Œë§ˆ ì¶”ê°€**: `static/player/{code}/themes/` í´ë”ì— CSS ì¶”ê°€

## ğŸ¯ í•µì‹¬ íŠ¹ì§•

âœ… **ì¤‘ë³µ ë°©ì§€**: PlayerCodeë¡œ UNIQUE ì œì•½  
âœ… **ìŠ¤ëƒ…ìƒ· ë°©ì‹**: ê¸°ì¡´ ë°ì´í„° ì‚­ì œ í›„ ì‹ ê·œ ì €ì¥  
âœ… **ìë™ ìˆ˜ì§‘**: ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ì£¼ê¸°ì  API í˜¸ì¶œ  
âœ… **ì„¤ì • ë¶„ë¦¬**: JSON íŒŒì¼ë¡œ í”Œë ˆì´ì–´ë³„ ì„¤ì • ê´€ë¦¬  
âœ… **ì¦‰ì‹œ ì„œë¹„ìŠ¤**: ë³„ë„ ì„¤ì¹˜ ì—†ì´ jar ì‹¤í–‰ë§Œìœ¼ë¡œ ì„œë¹„ìŠ¤ ì‹œì‘

ì´ êµ¬ì¡°ë¡œ **1-2ì‹œê°„ ë‚´ì— ì™„ì „í•œ í™˜ê²½ì •ë³´ ì„œë¹„ìŠ¤**ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!